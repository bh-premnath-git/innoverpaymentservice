_format_version: "3.0"
services:
  - name: ledger-svc
    url: http://ledger:8000
    routes:
      - name: ledger
        paths:
          - /api/ledger
        strip_path: false
        plugins:
          - name: openid-connect
            config:
              issuer: http://localhost:8081/realms/innover
              discovery: http://keycloak:8080/realms/innover/.well-known/openid-configuration
              client_id: kong
              client_secret: ${KONG_OIDC_CLIENT_SECRET}
              scopes:
                - openid
                - profile
              upstream_headers_claims: &oidc_claims
                - sub
                - preferred_username
                - roles
              upstream_headers_names: &oidc_headers
                - x-sub
                - x-username
                - x-roles
  - name: wallet-svc
    url: http://wallet:8000
    routes:
      - name: wallet
        paths:
          - /api/wallet
        strip_path: false
        plugins:
          - name: openid-connect
            config:
              issuer: http://localhost:8081/realms/innover
              discovery: http://keycloak:8080/realms/innover/.well-known/openid-configuration
              client_id: kong
              client_secret: ${KONG_OIDC_CLIENT_SECRET}
              scopes:
                - openid
                - profile
              upstream_headers_claims: *oidc_claims
              upstream_headers_names: *oidc_headers
  - name: rule-engine-svc
    url: http://rule-engine:8000
    routes:
      - name: rules
        paths:
          - /api/rules
        strip_path: false
        plugins:
          - name: openid-connect
            config:
              issuer: http://localhost:8081/realms/innover
              discovery: http://keycloak:8080/realms/innover/.well-known/openid-configuration
              client_id: kong
              client_secret: ${KONG_OIDC_CLIENT_SECRET}
              scopes:
                - openid
                - profile
              upstream_headers_claims: *oidc_claims
              upstream_headers_names: *oidc_headers
  - name: forex-svc
    url: http://forex:8000
    routes:
      - name: forex
        paths:
          - /api/fx
        strip_path: false
        plugins:
          - name: openid-connect
            config:
              issuer: http://localhost:8081/realms/innover
              discovery: http://keycloak:8080/realms/innover/.well-known/openid-configuration
              client_id: kong
              client_secret: ${KONG_OIDC_CLIENT_SECRET}
              scopes:
                - openid
                - profile
              upstream_headers_claims: *oidc_claims
              upstream_headers_names: *oidc_headers
  - name: profile-svc
    url: http://profile:8000
    routes:
      - name: profile
        paths:
          - /api/profile
        strip_path: false
        plugins:
          - name: openid-connect
            config:
              issuer: http://localhost:8081/realms/innover
              discovery: http://keycloak:8080/realms/innover/.well-known/openid-configuration
              client_id: kong
              client_secret: ${KONG_OIDC_CLIENT_SECRET}
              scopes:
                - openid
                - profile
              upstream_headers_claims: *oidc_claims
              upstream_headers_names: *oidc_headers
  - name: payment-svc
    url: http://payment:8000
    routes:
      - name: payment
        paths:
          - /api/payment
        strip_path: false
        plugins:
          - name: openid-connect
            config:
              issuer: http://localhost:8081/realms/innover
              discovery: http://keycloak:8080/realms/innover/.well-known/openid-configuration
              client_id: kong
              client_secret: ${KONG_OIDC_CLIENT_SECRET}
              scopes:
                - openid
                - profile
              upstream_headers_claims: *oidc_claims
              upstream_headers_names: *oidc_headers
