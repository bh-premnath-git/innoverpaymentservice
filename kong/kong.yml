_format_version: "3.0"
services:
  - name: ledger-svc
    url: http://ledger:8000
    routes:
      - name: ledger
        paths:
          - /api/ledger
        strip_path: false
        plugins:
          - name: openid-connect
            config:
              issuer: http://nginx/auth/realms/innover
              client_id: kong
              client_secret: ${KONG_OIDC_CLIENT_SECRET}
              discovery: http://nginx/auth/realms/innover/.well-known/openid-configuration
              introspection_endpoint: http://nginx/auth/realms/innover/protocol/openid-connect/token/introspect
              bearer_only: yes
              ssl_verify: no
              realm: innover
              redirect_uri_path: /auth/callback
              scopes:
                - openid
                - profile
              session_secret: ${KONG_SESSION_SECRET:-change-this-to-32-char-secret-key}
              logout_path: /logout
              upstream_headers_claims: &oidc_claims
                - sub
                - preferred_username
                - realm_access.roles
              upstream_headers_names: &oidc_headers
                - x-sub
                - x-username
                - x-roles
  - name: wallet-svc
    url: http://wallet:8000
    routes:
      - name: wallet
        paths:
          - /api/wallet
        strip_path: false
        plugins:
          - name: openid-connect
            config:
              issuer: http://nginx/auth/realms/innover
              discovery: http://nginx/auth/realms/innover/.well-known/openid-configuration
              client_id: kong
              client_secret: ${KONG_OIDC_CLIENT_SECRET}
              bearer_only: true
              introspection_endpoint: http://nginx/auth/realms/innover/protocol/openid-connect/token/introspect
              introspection_endpoint_auth_method: client_secret_post
              scopes:
                - openid
                - profile
              upstream_headers_claims: *oidc_claims
              upstream_headers_names: *oidc_headers
  - name: rule-engine-svc
    url: http://rule-engine:8000
    routes:
      - name: rules
        paths:
          - /api/rules
        strip_path: false
        plugins:
          - name: openid-connect
            config:
              issuer: http://nginx/auth/realms/innover
              discovery: http://nginx/auth/realms/innover/.well-known/openid-configuration
              client_id: kong
              client_secret: ${KONG_OIDC_CLIENT_SECRET}
              bearer_only: true
              introspection_endpoint: http://nginx/auth/realms/innover/protocol/openid-connect/token/introspect
              introspection_endpoint_auth_method: client_secret_post
              scopes:
                - openid
                - profile
              upstream_headers_claims: *oidc_claims
              upstream_headers_names: *oidc_headers
  - name: forex-svc
    url: http://forex:8000
    routes:
      - name: forex
        paths:
          - /api/fx
        strip_path: false
        plugins:
          - name: openid-connect
            config:
              issuer: http://nginx/auth/realms/innover
              discovery: http://nginx/auth/realms/innover/.well-known/openid-configuration
              client_id: kong
              client_secret: ${KONG_OIDC_CLIENT_SECRET}
              bearer_only: true
              introspection_endpoint: http://nginx/auth/realms/innover/protocol/openid-connect/token/introspect
              introspection_endpoint_auth_method: client_secret_post
              scopes:
                - openid
                - profile
              upstream_headers_claims: *oidc_claims
              upstream_headers_names: *oidc_headers
  - name: profile-svc
    url: http://profile:8000
    routes:
      - name: profile
        paths:
          - /api/profile
        strip_path: false
        plugins:
          - name: openid-connect
            config:
              issuer: http://nginx/auth/realms/innover
              discovery: http://nginx/auth/realms/innover/.well-known/openid-configuration
              client_id: kong
              client_secret: ${KONG_OIDC_CLIENT_SECRET}
              bearer_only: true
              introspection_endpoint: http://nginx/auth/realms/innover/protocol/openid-connect/token/introspect
              introspection_endpoint_auth_method: client_secret_post
              scopes:
                - openid
                - profile
              upstream_headers_claims: *oidc_claims
              upstream_headers_names: *oidc_headers
  - name: payment-svc
    url: http://payment:8000
    routes:
      - name: payment
        paths:
          - /api/payment
        strip_path: false
        plugins:
          - name: openid-connect
            config:
              issuer: http://nginx/auth/realms/innover
              discovery: http://nginx/auth/realms/innover/.well-known/openid-configuration
              client_id: kong
              client_secret: ${KONG_OIDC_CLIENT_SECRET}
              bearer_only: true
              introspection_endpoint: http://nginx/auth/realms/innover/protocol/openid-connect/token/introspect
              introspection_endpoint_auth_method: client_secret_post
              scopes:
                - openid
                - profile
              upstream_headers_claims: *oidc_claims
              upstream_headers_names: *oidc_headers
